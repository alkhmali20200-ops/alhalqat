<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #36c0a0; -webkit-text-stroke: #36c0a0}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #b76ff7; -webkit-text-stroke: #b76ff7}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083; min-height: 16.0px}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s5 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s6 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s7 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s8 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s9 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s10 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s11 {font-kerning: none}
    span.s12 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s13 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
    span.s14 {font-kerning: none; color: #a34f83; background-color: #171818; -webkit-text-stroke: 0px #a34f83}
    span.s15 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s4">html</span><span class="s5"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s1">"ar"</span><span class="s5"> </span><span class="s2">dir</span><span class="s3">=</span><span class="s1">"rtl"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s6">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s5"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">title</span><span class="s3">&gt;</span><span class="s1">نظام إدارة حلقات القرآن الكريم</span><span class="s3">&lt;/</span><span class="s4">title</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s7">@import</span><span class="s5"> </span><span class="s6">url</span><span class="s8">(</span><span class="s1">'https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;display=swap'</span><span class="s8">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">body</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s9">'Amiri'</span><span class="s8">,</span><span class="s1"> </span><span class="s6">serif</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s4">.print-page</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s1">page-break-after:</span><span class="s5"> </span><span class="s6">always</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>@</span><span class="s4">media</span><span class="s1"> </span><span class="s4">print</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>.no-print { </span><span class="s2">display:</span><span class="s1"> </span><span class="s6">none</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s4">body</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">font-size:</span><span class="s1"> </span><span class="s10">10px</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s4">.container</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s1">max-width:</span><span class="s5"> </span><span class="s6">none</span><span class="s8">;</span><span class="s5"> </span><span class="s1">margin:</span><span class="s5"> </span><span class="s10">0</span><span class="s8">;</span><span class="s5"> </span><span class="s1">padding:</span><span class="s5"> </span><span class="s10">5px</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s4">.student-card</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s1">page-break-inside:</span><span class="s5"> </span><span class="s6">avoid</span><span class="s8">;</span><span class="s5"> </span><span class="s1">margin-bottom:</span><span class="s5"> </span><span class="s10">20px</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">input</span><span class="s8">,</span><span class="s5"> </span><span class="s1">select</span><span class="s8">,</span><span class="s5"> </span><span class="s1">textarea</span><span class="s5"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s10">1px</span><span class="s1"> </span><span class="s6">solid</span><span class="s1"> #d1d5db</span><span class="s8">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s5"> </span><span class="s10">4px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s10">4px</span><span class="s1"> </span><span class="s10">8px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s9">'Amiri'</span><span class="s8">,</span><span class="s1"> </span><span class="s6">serif</span><span class="s8">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s6">transparent</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s4">.student-tab</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s1">transition:</span><span class="s5"> </span><span class="s6">all</span><span class="s5"> </span><span class="s10">0.3s</span><span class="s5"> </span><span class="s6">ease</span><span class="s8">;</span><span class="s5"> </span><span class="s1">cursor:</span><span class="s5"> </span><span class="s6">pointer</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s4">.student-tab.active</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s1">background-color:</span><span class="s5"> #3b82f6</span><span class="s8">;</span><span class="s5"> </span><span class="s1">color:</span><span class="s5"> </span><span class="s6">white</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">.student-tab:hover</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">background-color:</span><span class="s1"> #e5e7eb</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.student-tab.active:hover</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s2">background-color:</span><span class="s5"> #2563eb</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.student-content</span><span class="s8">,</span><span class="s5"> </span><span class="s1">.view</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s2">display:</span><span class="s5"> </span><span class="s6">none</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">.view.active</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">display:</span><span class="s1"> </span><span class="s6">block</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.student-content.active</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s2">display:</span><span class="s5"> </span><span class="s6">block</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">.delete-btn</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">transition:</span><span class="s1"> </span><span class="s6">all</span><span class="s1"> </span><span class="s10">0.2s</span><span class="s1"> </span><span class="s6">ease</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s4">.delete-btn:hover</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> </span><span class="s1">transform:</span><span class="s5"> </span><span class="s6">scale(</span><span class="s10">1.1</span><span class="s6">)</span><span class="s8">;</span><span class="s5"> </span><span class="s1">background-color:</span><span class="s5"> #fee2e2</span><span class="s8">;</span><span class="s5"> </span><span class="s8">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s4">body</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-50 p-4"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- App Container --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"container mx-auto max-w-7xl bg-white shadow-lg rounded-lg p-6"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- View 1: Section Selection --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"selectionView"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"view active text-center py-16"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">h1</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-3xl font-bold mb-8 text-gray-700"</span><span class="s3">&gt;</span><span class="s1">نظام إدارة حلقات القرآن الكريم</span><span class="s3">&lt;/</span><span class="s4">h1</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-lg text-gray-500 mb-12"</span><span class="s3">&gt;</span><span class="s1">الرجاء تحديد القسم للبدء</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-col sm:flex-row justify-center gap-4 sm:gap-8"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"selectMenBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-lg text-xl shadow-lg transition-transform transform hover:scale-105"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>قسم الرجال</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"selectWomenBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-pink-500 hover:bg-pink-600 text-white font-bold py-4 px-10 rounded-lg text-xl shadow-lg transition-transform transform hover:scale-105"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>قسم النساء</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s6">"firebase-status"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"mt-8 text-gray-400 text-sm"</span><span class="s3">&gt;</span><span class="s1">جاري الاتصال بقاعدة البيانات...</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- View 2: Halaqa Dashboard --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"dashboardView"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"view"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-wrap justify-between items-center mb-6 gap-4"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">h1</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"dashboardTitle"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-3xl font-bold text-gray-700"</span><span class="s3">&gt;&lt;/</span><span class="s4">h1</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"backToSectionsBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>العودة للأقسام</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-50 p-6 rounded-lg border border-gray-200"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">h2</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-xl font-bold mb-4"</span><span class="s3">&gt;</span><span class="s1">إضافة حلقة جديدة</span><span class="s3">&lt;/</span><span class="s4">h2</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-wrap gap-4 items-end"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"flex-grow"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s5"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"newHalaqaName"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-700"</span><span class="s3">&gt;</span><span class="s5">اسم الحلقة</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"newHalaqaName"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-1 block w-full border-gray-300 rounded-md shadow-sm"</span><span class="s5"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"مثال: حلقة المبتدئين"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"flex-grow"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s5"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"newTeacherName"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-700"</span><span class="s3">&gt;</span><span class="s5">اسم المعلم/ة</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"newTeacherName"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-1 block w-full border-gray-300 rounded-md shadow-sm"</span><span class="s5"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"اسم المعلم/ة المسؤول/ة"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"addNewHalaqaBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>➕ إضافة</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">hr</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"my-8"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-wrap gap-4 justify-between items-center mb-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s3">&lt;</span><span class="s4">h2</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-xl font-bold"</span><span class="s3">&gt;</span><span class="s1">الحلقات المسجلة</span><span class="s3">&lt;/</span><span class="s4">h2</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                     </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"generateReportBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>📈 إنشاء تقرير أسبوعي للقسم</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"halaqaList"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Content is now fully managed by JavaScript --&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- View 3: Halaqa Management --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"halaqaView"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"view"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Back to Dashboard Button --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">             </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-start mb-4 no-print"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"backToDashboardBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>→ العودة للوحة التحكم</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Circle Header --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"border-2 border-gray-800 p-4 mb-6"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center gap-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"font-bold"</span><span class="s3">&gt;</span><span class="s1">المعلم /</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"teacherName"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 border-b border-gray-400 bg-transparent"</span><span class="s5"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"اسم المعلم"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center gap-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"font-bold"</span><span class="s3">&gt;</span><span class="s1">اسم الحلقة /</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"circleName"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 border-b border-gray-400 bg-transparent"</span><span class="s5"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"اسم الحلقة"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center gap-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"font-bold"</span><span class="s3">&gt;</span><span class="s1">الشهر /</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">select</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"month"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"border-b border-gray-400 bg-transparent"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">                           </span></span><span class="s3">&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">""</span><span class="s3">&gt;</span><span class="s5">اختر الشهر</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"محرم"</span><span class="s3">&gt;</span><span class="s5">محرم</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"صفر"</span><span class="s3">&gt;</span><span class="s5">صفر</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"ربيع الأول"</span><span class="s3">&gt;</span><span class="s5">ربيع الأول</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"ربيع الثاني"</span><span class="s3">&gt;</span><span class="s5">ربيع الثاني</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"جمادى الأولى"</span><span class="s3">&gt;</span><span class="s5">جمادى الأولى</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"جمادى الثانية"</span><span class="s3">&gt;</span><span class="s5">جمادى الثانية</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"رجب"</span><span class="s3">&gt;</span><span class="s5">رجب</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"شعبان"</span><span class="s3">&gt;</span><span class="s5">شعبان</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"رمضان"</span><span class="s3">&gt;</span><span class="s5">رمضان</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"شوال"</span><span class="s3">&gt;</span><span class="s5">شوال</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"ذو القعدة"</span><span class="s3">&gt;</span><span class="s5">ذو القعدة</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;&lt;</span><span class="s1">option</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"ذو الحجة"</span><span class="s3">&gt;</span><span class="s5">ذو الحجة</span><span class="s3">&lt;/</span><span class="s1">option</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">select</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center"</span><span class="s3">&gt;&lt;</span><span class="s4">span</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"currentHijriYear"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"font-bold text-lg"</span><span class="s3">&gt;&lt;/</span><span class="s4">span</span><span class="s3">&gt;&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Student Management Section --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-6 no-print"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">h3</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"font-bold text-lg mb-3"</span><span class="s3">&gt;</span><span class="s1">إدارة الطلاب</span><span class="s3">&lt;/</span><span class="s4">h3</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex gap-4 items-center flex-wrap"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"newStudentName"</span><span class="s5"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"اسم الطالب الجديد"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-grow"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"newStudentGrade"</span><span class="s5"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"المرحلة الدراسية"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-grow"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"newStudentCivilId"</span><span class="s5"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"السجل المدني"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-grow"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"addStudentBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold"</span><span class="s3">&gt;</span><span class="s5">➕ إضافة طالب</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Students Tabs --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"studentsTabsContainer"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-6 no-print"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex flex-wrap gap-2 mb-4 border-b border-gray-300 pb-2"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"studentsTabs"</span><span class="s3">&gt;&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Students Content Area --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"studentsContentContainer"</span><span class="s3">&gt;&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Action Buttons --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex gap-4 mb-6 no-print flex-wrap"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"addWeekBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-bold"</span><span class="s3">&gt;</span><span class="s5">إضافة أسبوع للطالب الحالي</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"calculateBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-bold"</span><span class="s3">&gt;</span><span class="s5">حساب المجاميع</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"printBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-bold"</span><span class="s3">&gt;</span><span class="s5">📄 إنشاء تقرير (PDF/طباعة)</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"exportBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-bold"</span><span class="s3">&gt;</span><span class="s5">📄 تصدير لإكسل</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">             </span></span><span class="s1">&lt;!-- Save Status --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"saveStatus"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-4 p-3 rounded-lg hidden"</span><span class="s3">&gt;&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- Halaqa Summary --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"halaqaSummary"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-8 p-6 bg-blue-50 border border-blue-200 rounded-lg no-print hidden"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-between items-center mb-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">h3</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-xl font-bold text-blue-800"</span><span class="s3">&gt;</span><span class="s1">ملخص إنجازات الحلقة</span><span class="s3">&lt;/</span><span class="s4">h3</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"printSummaryBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-500 hover:bg-gray-600 text-white px-4 py-1 rounded-lg font-bold"</span><span class="s3">&gt;</span><span class="s5">🖨️ طباعة الملخص</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-2 md:grid-cols-4 gap-4 text-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-green-600"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"halaqaTotalMemorization"</span><span class="s3">&gt;</span><span class="s5">0</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-sm text-gray-600"</span><span class="s3">&gt;</span><span class="s1">إجمالي أوجه الحفظ</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-indigo-600"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"halaqaTotalReview"</span><span class="s3">&gt;</span><span class="s5">0</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-sm text-gray-600"</span><span class="s3">&gt;</span><span class="s1">إجمالي أوجه المراجعة</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-teal-600"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"halaqaTotalAttendance"</span><span class="s3">&gt;</span><span class="s5">0</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-sm text-gray-600"</span><span class="s3">&gt;</span><span class="s1">إجمالي أيام الحضور</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl font-bold text-red-600"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"halaqaTotalAbsence"</span><span class="s3">&gt;</span><span class="s5">0</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-sm text-gray-600"</span><span class="s3">&gt;</span><span class="s1">إجمالي أيام الغياب</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Share Modal --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"shareModal"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden no-print"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white rounded-lg p-6 w-full max-w-md text-center shadow-2xl"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">h3</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-xl font-bold mb-4"</span><span class="s3">&gt;</span><span class="s1">مشاركة رابط الحلقة</span><span class="s3">&lt;/</span><span class="s4">h3</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-gray-600 mb-4"</span><span class="s3">&gt;</span><span class="s1">انسخ هذا الرابط وأرسله للمعلم/ة. سيتمكن من الدخول مباشرة إلى الحلقة.</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"shareLinkInput"</span><span class="s5"> </span><span class="s2">readonly</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-2 border rounded-md text-center bg-gray-100 mb-4 font-mono"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex gap-4 justify-center"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"copyShareLinkBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg"</span><span class="s3">&gt;</span><span class="s5">نسخ الرابط</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"closeShareModalBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg"</span><span class="s3">&gt;</span><span class="s5">إغلاق</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> initializeApp </span><span class="s8">}</span><span class="s5"> </span><span class="s7">from</span><span class="s5"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"</span><span class="s8">;</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> getFirestore</span><span class="s8">,</span><span class="s5"> doc</span><span class="s8">,</span><span class="s5"> getDoc</span><span class="s8">,</span><span class="s5"> setDoc</span><span class="s8">,</span><span class="s5"> onSnapshot </span><span class="s8">}</span><span class="s5"> </span><span class="s7">from</span><span class="s5"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> getAuth</span><span class="s8">,</span><span class="s1"> signInWithCustomToken</span><span class="s8">,</span><span class="s1"> signInAnonymously </span><span class="s8">}</span><span class="s1"> </span><span class="s7">from</span><span class="s1"> </span><span class="s9">"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">// ===================================================================================</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">// == AppManager: Handles high-level logic (views, sections, halaqa management)</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">// ===================================================================================</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s7">class</span><span class="s5"> </span><span class="s1">AppManager</span><span class="s5"> </span><span class="s8">{</span></p>
<p class="p9"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">constructor</span><span class="s8">()</span><span class="s5"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> men</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[],</span><span class="s1"> women</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[]</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqaId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">halaqaManager </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">HalaqaManager</span><span class="s8">(</span><span class="s7">this</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">db </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">unsubscribe </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">initialLinkHandled </span><span class="s8">=</span><span class="s1"> </span><span class="s7">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">initFirebase</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">async</span><span class="s1"> initFirebase</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> firebaseConfig </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __firebase_config </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s12">JSON</span><span class="s8">.</span><span class="s1">parse</span><span class="s8">(</span><span class="s1">__firebase_config</span><span class="s8">)</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> appId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __app_id </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> __app_id </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'default-quran-app'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> app </span><span class="s8">=</span><span class="s1"> initializeApp</span><span class="s8">(</span><span class="s1">firebaseConfig</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">db </span><span class="s8">=</span><span class="s1"> getFirestore</span><span class="s8">(</span><span class="s1">app</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> auth </span><span class="s8">=</span><span class="s1"> getAuth</span><span class="s8">(</span><span class="s1">app</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> token </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __initial_auth_token </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> __initial_auth_token </span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">token</span><span class="s8">)</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> signInWithCustomToken</span><span class="s8">(</span><span class="s1">auth</span><span class="s8">,</span><span class="s1"> token</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">else</span><span class="s1"> </span><span class="s7">await</span><span class="s1"> signInAnonymously</span><span class="s8">(</span><span class="s1">auth</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'firebase-status'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'متصل بقاعدة البيانات ✅'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">listenForDataChanges</span><span class="s8">(</span><span class="s1">appId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Firebase initialization failed:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'firebase-status'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'فشل الاتصال بقاعدة البيانات ❌'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>listenForDataChanges</span><span class="s8">(</span><span class="s1">appId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> docRef </span><span class="s8">=</span><span class="s1"> doc</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">db</span><span class="s8">,</span><span class="s1"> </span><span class="s9">"artifacts"</span><span class="s8">,</span><span class="s1"> appId</span><span class="s8">,</span><span class="s1"> </span><span class="s9">"public/data"</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">unsubscribe </span><span class="s8">=</span><span class="s1"> onSnapshot</span><span class="s8">(</span><span class="s1">docRef</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">docSnap</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">docSnap</span><span class="s8">.</span><span class="s1">exists</span><span class="s8">())</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> data </span><span class="s8">=</span><span class="s1"> docSnap</span><span class="s8">.</span><span class="s1">data</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> men</span><span class="s8">:</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">men </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[],</span><span class="s1"> women</span><span class="s8">:</span><span class="s1"> data</span><span class="s8">.</span><span class="s1">women </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> men</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[],</span><span class="s1"> women</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[]</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">initialLinkHandled</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">handleDirectLinkAfterDataLoad</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection </span><span class="s8">&amp;&amp;</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'dashboardView'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">contains</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">renderDashboard</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">},</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Error listening to data:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s5">halaqaManager</span><span class="s8">.</span><span class="s5">showMessage</span><span class="s8">(</span><span class="s1">'حدث خطأ في المزامنة مع قاعدة البيانات'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'error'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>handleDirectLinkAfterDataLoad</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">initialLinkHandled </span><span class="s8">=</span><span class="s1"> </span><span class="s7">true</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> hash </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">.</span><span class="s1">location</span><span class="s8">.</span><span class="s1">hash</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">hash </span><span class="s8">&amp;&amp;</span><span class="s1"> hash</span><span class="s8">.</span><span class="s1">startsWith</span><span class="s8">(</span><span class="s9">'#halaqa_id='</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> halaqaId </span><span class="s8">=</span><span class="s1"> hash</span><span class="s8">.</span><span class="s1">substring</span><span class="s8">(</span><span class="s9">'#halaqa_id='</span><span class="s8">.</span><span class="s1">length</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> section </span><span class="s8">=</span><span class="s1"> halaqaId</span><span class="s8">.</span><span class="s1">startsWith</span><span class="s8">(</span><span class="s9">'men'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'men'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> halaqaId</span><span class="s8">.</span><span class="s1">startsWith</span><span class="s8">(</span><span class="s9">'women'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'women'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">section</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> halaqa </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s1">section</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">find</span><span class="s8">(</span><span class="s1">h </span><span class="s8">=&gt;</span><span class="s1"> h</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> halaqaId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">halaqa</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection </span><span class="s8">=</span><span class="s1"> section</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">openHalaqa</span><span class="s8">(</span><span class="s1">halaqaId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                         </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showView</span><span class="s8">(</span><span class="s9">'selectionView'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showView</span><span class="s8">(</span><span class="s9">'selectionView'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showView</span><span class="s8">(</span><span class="s9">'selectionView'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">async</span><span class="s1"> saveData</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">db</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> appId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">typeof</span><span class="s1"> __app_id </span><span class="s8">!==</span><span class="s1"> </span><span class="s9">'undefined'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> __app_id </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'default-quran-app'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> docRef </span><span class="s8">=</span><span class="s1"> doc</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">db</span><span class="s8">,</span><span class="s1"> </span><span class="s9">"artifacts"</span><span class="s8">,</span><span class="s1"> appId</span><span class="s8">,</span><span class="s1"> </span><span class="s9">"public/data"</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s1"> setDoc</span><span class="s8">(</span><span class="s1">docRef</span><span class="s8">,</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> merge</span><span class="s8">:</span><span class="s1"> </span><span class="s7">true</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">error</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Error saving data:"</span><span class="s8">,</span><span class="s1"> error</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">halaqaManager</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'خطأ في حفظ البيانات!'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'error'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>showView</span><span class="s8">(</span><span class="s1">viewId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.view'</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">v </span><span class="s8">=&gt;</span><span class="s1"> v</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> viewToShow </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s1">viewId</span><span class="s8">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s8">(</span><span class="s1">viewToShow</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>viewToShow</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">viewId </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'dashboardView'</span><span class="s8">)</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">renderDashboard</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'selectionView'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>selectSection</span><span class="s8">(</span><span class="s1">section</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection </span><span class="s8">=</span><span class="s1"> section</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'dashboardTitle'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`لوحة تحكم </span><span class="s8">${</span><span class="s1">section </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'men'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'قسم الرجال'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'قسم النساء'</span><span class="s8">}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showView</span><span class="s8">(</span><span class="s9">'dashboardView'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>renderDashboard</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> halaqaList </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'halaqaList'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> halaqas </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>halaqaList</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">halaqas</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s13">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                 </span>halaqaList</span><span class="s8">.</span><span class="s5">innerHTML </span><span class="s8">=</span><span class="s5"> </span><span class="s1">`&lt;p class="text-gray-500 col-span-full"&gt;لا توجد حلقات مسجلة في هذا القسم بعد.&lt;/p&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span>halaqas</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">halaqa </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> card </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'div'</span><span class="s8">);</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                    </span>card</span><span class="s8">.</span><span class="s5">className </span><span class="s8">=</span><span class="s5"> </span><span class="s1">'bg-white p-6 rounded-lg shadow-md border border-gray-200'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>card</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h3 class="text-lg font-bold text-blue-800"&gt;</span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">circleName</span><span class="s8">}</span><span class="s1">&lt;/h3&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-gray-600 mb-4"&gt;</span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">teacherName</span><span class="s8">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex gap-2 mt-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                           </span>&lt;button data-halaqa-id="</span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">id</span><span class="s8">}</span><span class="s1">" class="open-halaqa-btn flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg"&gt;فتح&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                           </span>&lt;button data-halaqa-id="</span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">id</span><span class="s8">}</span><span class="s1">" class="share-halaqa-btn flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg"&gt;مشاركة&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                           </span>&lt;button data-halaqa-id="</span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">id</span><span class="s8">}</span><span class="s1">" class="delete-halaqa-btn bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg"&gt;حذف&lt;/button&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>halaqaList</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">card</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>shareHalaqa</span><span class="s8">(</span><span class="s1">halaqaId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> baseUrl </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">.</span><span class="s1">location</span><span class="s8">.</span><span class="s1">href</span><span class="s8">.</span><span class="s1">split</span><span class="s8">(</span><span class="s9">'#'</span><span class="s8">)[</span><span class="s13">0</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> shareableLink </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span><span class="s8">${</span><span class="s1">baseUrl</span><span class="s8">}</span><span class="s9">#halaqa_id=</span><span class="s8">${</span><span class="s1">halaqaId</span><span class="s8">}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'shareLinkInput'</span><span class="s8">).</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> shareableLink</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'shareModal'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s9">"Error creating share link:"</span><span class="s8">,</span><span class="s1"> e</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">halaqaManager</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'فشل إنشاء رابط المشاركة.'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'error'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>addNewHalaqa</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> circleName </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newHalaqaName'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> teacherName </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newTeacherName'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">circleName </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">teacherName</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">halaqaManager</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'يرجى إدخال اسم الحلقة واسم المعلم'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'warning'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> newHalaqa </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>id</span><span class="s8">:</span><span class="s1"> </span><span class="s9">`</span><span class="s8">${</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">}</span><span class="s9">_</span><span class="s8">${</span><span class="s12">Date</span><span class="s8">.</span><span class="s1">now</span><span class="s8">()}</span><span class="s9">`</span><span class="s8">,</span><span class="s1"> circleName</span><span class="s8">,</span><span class="s1"> teacherName</span><span class="s8">,</span><span class="s1"> month</span><span class="s8">:</span><span class="s1"> </span><span class="s9">''</span><span class="s8">,</span><span class="s1"> students</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[],</span><span class="s1"> studentIdCounter</span><span class="s8">:</span><span class="s1"> </span><span class="s13">1</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">].</span><span class="s1">push</span><span class="s8">(</span><span class="s1">newHalaqa</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">saveData</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newHalaqaName'</span><span class="s8">).</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newTeacherName'</span><span class="s8">).</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">halaqaManager</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'تمت إضافة الحلقة بنجاح'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'success'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>deleteHalaqa</span><span class="s8">(</span><span class="s1">halaqaId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> halaqaIndex </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">].</span><span class="s1">findIndex</span><span class="s8">(</span><span class="s1">h </span><span class="s8">=&gt;</span><span class="s1"> h</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> halaqaId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">halaqaIndex </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s8">-</span><span class="s13">1</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">].</span><span class="s1">splice</span><span class="s8">(</span><span class="s1">halaqaIndex</span><span class="s8">,</span><span class="s1"> </span><span class="s13">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">saveData</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">halaqaManager</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'تم حذف الحلقة بنجاح'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'warning'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>openHalaqa</span><span class="s8">(</span><span class="s1">halaqaId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqaId </span><span class="s8">=</span><span class="s1"> halaqaId</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> halaqa </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">find</span><span class="s8">(</span><span class="s1">h </span><span class="s8">=&gt;</span><span class="s1"> h</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> halaqaId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">halaqa</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">halaqaManager</span><span class="s8">.</span><span class="s1">loadHalaqa</span><span class="s8">(</span><span class="s1">halaqa</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showView</span><span class="s8">(</span><span class="s9">'halaqaView'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>updateCurrentHalaqa</span><span class="s8">(</span><span class="s1">halaqaData</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> halaqaIndex </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">].</span><span class="s1">findIndex</span><span class="s8">(</span><span class="s1">h </span><span class="s8">=&gt;</span><span class="s1"> h</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqaId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">halaqaIndex </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s8">-</span><span class="s13">1</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">][</span><span class="s1">halaqaIndex</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> halaqaData</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">saveData</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>calculateHalaqaTotals</span><span class="s8">(</span><span class="s1">halaqa</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> totals </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> totalMemorization</span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> totalReview</span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> totalAttendance</span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> totalAbsence</span><span class="s8">:</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">halaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> totals</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>halaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">student </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">week </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">(</span><span class="s1">week</span><span class="s8">.</span><span class="s1">days </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">day </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>totals</span><span class="s8">.</span><span class="s1">totalMemorization </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">Number</span><span class="s8">(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">hifdhFaces</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>totals</span><span class="s8">.</span><span class="s1">totalReview </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">Number</span><span class="s8">(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">murajaaFaces</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">attendance </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'حضر'</span><span class="s8">)</span><span class="s1"> totals</span><span class="s8">.</span><span class="s1">totalAttendance</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">attendance </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'غاب'</span><span class="s8">)</span><span class="s1"> totals</span><span class="s8">.</span><span class="s1">totalAbsence</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> totals</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>generateSectionReport</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> sectionHalaqas </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">appData</span><span class="s8">[</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">sectionHalaqas</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s13">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s5"> </span><span class="s7">this</span><span class="s8">.</span><span class="s5">halaqaManager</span><span class="s8">.</span><span class="s5">showMessage</span><span class="s8">(</span><span class="s1">'لا توجد حلقات في هذا القسم لإنشاء تقرير'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'warning'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> sectionName </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentSection </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'men'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s9">'الرجال'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s9">'النساء'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> today </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">halaqaManager</span><span class="s8">.</span><span class="s1">getHijriDateString</span><span class="s8">(</span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">());</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> reportHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!DOCTYPE html&gt;&lt;html lang="ar" dir="rtl"&gt;&lt;head&gt;&lt;meta charset="UTF-8"&gt;&lt;title&gt;تقرير قسم </span><span class="s8">${</span><span class="s5">sectionName</span><span class="s8">}</span><span class="s1">&lt;/title&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;\/script&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;style&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>@import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;display=swap');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>body { font-family: 'Amiri', serif; margin: 20px; } table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>th, td { border: 1px solid #ddd; padding: 12px; text-align: center; } thead { background-color: #f2f2f2; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>.header { text-align: center; margin-bottom: 2rem; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/style&gt;&lt;/head&gt;&lt;body&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="header"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h1 class="text-3xl font-bold"&gt;التقرير الأسبوعي الشامل لقسم </span><span class="s8">${</span><span class="s5">sectionName</span><span class="s8">}</span><span class="s1">&lt;/h1&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-lg text-gray-600"&gt;تاريخ التقرير: </span><span class="s8">${</span><span class="s5">today</span><span class="s8">}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;table&gt;&lt;thead&gt;&lt;tr&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;th&gt;اسم الحلقة&lt;/th&gt;&lt;th&gt;اسم المعلم/ة&lt;/th&gt;&lt;th&gt;عدد الطلاب&lt;/th&gt;&lt;th&gt;إجمالي أوجه الحفظ&lt;/th&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;th&gt;إجمالي أوجه المراجعة&lt;/th&gt;&lt;th&gt;إجمالي الحضور&lt;/th&gt;&lt;th&gt;إجمالي الغياب&lt;/th&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>sectionHalaqas</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">halaqa </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> totals </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">calculateHalaqaTotals</span><span class="s8">(</span><span class="s1">halaqa</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>reportHTML </span><span class="s8">+=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;tr&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">                        </span>&lt;td&gt;</span><span class="s8">${</span><span class="s1">halaqa</span><span class="s8">.</span><span class="s1">circleName</span><span class="s8">}</span><span class="s9">&lt;/td&gt;&lt;td&gt;</span><span class="s8">${</span><span class="s1">halaqa</span><span class="s8">.</span><span class="s1">teacherName</span><span class="s8">}</span><span class="s9">&lt;/td&gt;&lt;td&gt;</span><span class="s8">${(</span><span class="s1">halaqa</span><span class="s8">.</span><span class="s1">students </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">length</span><span class="s8">}</span><span class="s9">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="font-bold text-green-600"&gt;</span><span class="s8">${</span><span class="s5">totals</span><span class="s8">.</span><span class="s5">totalMemorization</span><span class="s8">}</span><span class="s1">&lt;/td&gt;&lt;td class="font-bold text-indigo-600"&gt;</span><span class="s8">${</span><span class="s5">totals</span><span class="s8">.</span><span class="s5">totalReview</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;td class="font-bold text-teal-600"&gt;</span><span class="s8">${</span><span class="s5">totals</span><span class="s8">.</span><span class="s5">totalAttendance</span><span class="s8">}</span><span class="s1">&lt;/td&gt;&lt;td class="font-bold text-red-600"&gt;</span><span class="s8">${</span><span class="s5">totals</span><span class="s8">.</span><span class="s5">totalAbsence</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/tr&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span>reportHTML </span><span class="s8">+=</span><span class="s5"> </span><span class="s1">`&lt;/tbody&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> reportWindow </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">.</span><span class="s1">open</span><span class="s8">(</span><span class="s9">''</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'_blank'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">document</span><span class="s8">.</span><span class="s1">write</span><span class="s8">(</span><span class="s1">reportHTML</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">document</span><span class="s8">.</span><span class="s1">close</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">onload </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> reportWindow</span><span class="s8">.</span><span class="s1">print</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">// ===================================================================================</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">// == HalaqaManager: Manages the detailed view of a single halaqa (students, tables)</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">// ===================================================================================</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s7">class</span><span class="s5"> </span><span class="s1">HalaqaManager</span><span class="s5"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">constructor</span><span class="s8">(</span><span class="s1">appManager</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">app </span><span class="s8">=</span><span class="s1"> appManager</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">debounceTimer </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">initializeEventListeners</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>initializeEventListeners</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'addStudentBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">addStudent</span><span class="s8">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'addWeekBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">addWeekToCurrentStudent</span><span class="s8">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'calculateBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">calculateAllTotals</span><span class="s8">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'printBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">generatePrintableReport</span><span class="s8">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'exportBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">exportHalaqaToCSV</span><span class="s8">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'printSummaryBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">printHalaqaSummary</span><span class="s8">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newStudentName'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'keypress'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">key </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'Enter'</span><span class="s8">)</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">addStudent</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'halaqaView'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'input'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'جاري الحفظ...'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'info'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>clearTimeout</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">debounceTimer</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">debounceTimer </span><span class="s8">=</span><span class="s1"> setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">captureAndSaveHalaqa</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'تم الحفظ بنجاح!'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'success'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">},</span><span class="s1"> </span><span class="s13">1500</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>getHijriDateParts</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> today </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> yearFormatter </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Intl</span><span class="s8">.</span><span class="s12">DateTimeFormat</span><span class="s8">(</span><span class="s9">'ar-SA-u-ca-islamic'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> year</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'numeric'</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> monthFormatter </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Intl</span><span class="s8">.</span><span class="s12">DateTimeFormat</span><span class="s8">(</span><span class="s9">'ar-SA-u-ca-islamic'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> month</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'long'</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> year </span><span class="s8">=</span><span class="s1"> yearFormatter</span><span class="s8">.</span><span class="s1">format</span><span class="s8">(</span><span class="s1">today</span><span class="s8">).</span><span class="s1">replace</span><span class="s8">(</span><span class="s14">/\s*هـ.*/</span><span class="s8">,</span><span class="s1"> </span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> monthName </span><span class="s8">=</span><span class="s1"> monthFormatter</span><span class="s8">.</span><span class="s1">format</span><span class="s8">(</span><span class="s1">today</span><span class="s8">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> year</span><span class="s8">,</span><span class="s1"> monthName </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>loadHalaqa</span><span class="s8">(</span><span class="s1">halaqaData</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa </span><span class="s8">=</span><span class="s1"> </span><span class="s12">JSON</span><span class="s8">.</span><span class="s1">parse</span><span class="s8">(</span><span class="s12">JSON</span><span class="s8">.</span><span class="s1">stringify</span><span class="s8">(</span><span class="s1">halaqaData</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'studentsTabs'</span><span class="s8">).</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'studentsContentContainer'</span><span class="s8">).</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'halaqaSummary'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> year</span><span class="s8">,</span><span class="s1"> monthName </span><span class="s8">}</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">getHijriDateParts</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'currentHijriYear'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`لعام </span><span class="s8">${</span><span class="s1">year</span><span class="s8">}</span><span class="s9">هـ`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'teacherName'</span><span class="s8">).</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">teacherName</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'circleName'</span><span class="s8">).</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">circleName</span><span class="s8">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> monthSelect </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'month'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">month</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>monthSelect</span><span class="s8">.</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">month</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> currentMonthOption </span><span class="s8">=</span><span class="s1"> </span><span class="s12">Array</span><span class="s8">.</span><span class="s7">from</span><span class="s8">(</span><span class="s1">monthSelect</span><span class="s8">.</span><span class="s1">options</span><span class="s8">).</span><span class="s1">find</span><span class="s8">(</span><span class="s1">opt </span><span class="s8">=&gt;</span><span class="s1"> opt</span><span class="s8">.</span><span class="s1">text </span><span class="s8">===</span><span class="s1"> monthName</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">currentMonthOption</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>monthSelect</span><span class="s8">.</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> currentMonthOption</span><span class="s8">.</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">month </span><span class="s8">=</span><span class="s1"> currentMonthOption</span><span class="s8">.</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span>monthSelect</span><span class="s8">.</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">""</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">student </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">createStudentTab</span><span class="s8">(</span><span class="s1">student</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">createStudentContentWithData</span><span class="s8">(</span><span class="s1">student</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students </span><span class="s8">&amp;&amp;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">switchToStudent</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">[</span><span class="s13">0</span><span class="s8">].</span><span class="s1">id</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>captureAndSaveHalaqa</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">teacherName </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'teacherName'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">circleName </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'circleName'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">month </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'month'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">student </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">captureStudentData</span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">app</span><span class="s8">.</span><span class="s1">updateCurrentHalaqa</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>addStudent</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> nameInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newStudentName'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> studentName </span><span class="s8">=</span><span class="s1"> nameInput</span><span class="s8">.</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">studentName</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'يرجى إدخال اسم الطالب'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'warning'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">studentIdCounter</span><span class="s8">)</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">studentIdCounter </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">length </span><span class="s8">+</span><span class="s1"> </span><span class="s13">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> studentId </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`student_</span><span class="s8">${</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">studentIdCounter</span><span class="s8">++}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> newStudent </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>id</span><span class="s8">:</span><span class="s1"> studentId</span><span class="s8">,</span><span class="s1"> name</span><span class="s8">:</span><span class="s1"> studentName</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>grade</span><span class="s8">:</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newStudentGrade'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>civilId</span><span class="s8">:</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newStudentCivilId'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">.</span><span class="s1">trim</span><span class="s8">(),</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>data</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> weeks</span><span class="s8">:</span><span class="s1"> </span><span class="s8">[{</span><span class="s1"> days</span><span class="s8">:</span><span class="s1"> </span><span class="s12">Array</span><span class="s8">(</span><span class="s13">4</span><span class="s8">).</span><span class="s1">fill</span><span class="s8">({}).</span><span class="s1">map</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">({</span><span class="s1"> date</span><span class="s8">:</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">getHijriDateString</span><span class="s8">(</span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">())</span><span class="s1"> </span><span class="s8">}))</span><span class="s1"> </span><span class="s8">}]</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">)</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">newStudent</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">createStudentTab</span><span class="s8">(</span><span class="s1">newStudent</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">createStudentContentWithData</span><span class="s8">(</span><span class="s1">newStudent</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">switchToStudent</span><span class="s8">(</span><span class="s1">studentId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>nameInput</span><span class="s8">.</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newStudentGrade'</span><span class="s8">).</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'newStudentCivilId'</span><span class="s8">).</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">captureAndSaveHalaqa</span><span class="s8">();</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s5">showMessage</span><span class="s8">(</span><span class="s1">'تم إضافة الطالب بنجاح!'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'success'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>removeStudent</span><span class="s8">(</span><span class="s1">studentId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> studentIndex </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">findIndex</span><span class="s8">(</span><span class="s1">s </span><span class="s8">=&gt;</span><span class="s1"> s</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> studentId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s8">(</span><span class="s1">studentIndex </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s8">-</span><span class="s13">1</span><span class="s8">){</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> studentName </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">[</span><span class="s1">studentIndex</span><span class="s8">].</span><span class="s1">name</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">splice</span><span class="s8">(</span><span class="s1">studentIndex</span><span class="s8">,</span><span class="s1"> </span><span class="s13">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">`tab_</span><span class="s8">${</span><span class="s1">studentId</span><span class="s8">}</span><span class="s9">`</span><span class="s8">).</span><span class="s1">remove</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">`content_</span><span class="s8">${</span><span class="s1">studentId</span><span class="s8">}</span><span class="s9">`</span><span class="s8">).</span><span class="s1">remove</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId </span><span class="s8">===</span><span class="s1"> studentId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">length </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s13">0</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">[</span><span class="s13">0</span><span class="s8">].</span><span class="s1">id </span><span class="s8">:</span><span class="s1"> </span><span class="s7">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId</span><span class="s8">)</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">switchToStudent</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">captureAndSaveHalaqa</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">`تم حذف الطالب: </span><span class="s8">${</span><span class="s1">studentName</span><span class="s8">}</span><span class="s9">`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'warning'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>switchToStudent</span><span class="s8">(</span><span class="s1">studentId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">find</span><span class="s8">(</span><span class="s1">s </span><span class="s8">=&gt;</span><span class="s1"> s</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> studentId</span><span class="s8">))</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId </span><span class="s8">=</span><span class="s1"> studentId</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.student-tab'</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">t </span><span class="s8">=&gt;</span><span class="s1"> t</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.student-content'</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">c </span><span class="s8">=&gt;</span><span class="s1"> c</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">`tab_</span><span class="s8">${</span><span class="s1">studentId</span><span class="s8">}</span><span class="s9">`</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">`content_</span><span class="s8">${</span><span class="s1">studentId</span><span class="s8">}</span><span class="s9">`</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>addWeekToCurrentStudent</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'يرجى اختيار طالب أولاً'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'warning'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> student </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">find</span><span class="s8">(</span><span class="s1">s </span><span class="s8">=&gt;</span><span class="s1"> s</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">student</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks</span><span class="s8">)</span><span class="s1"> student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks</span><span class="s8">.</span><span class="s1">push</span><span class="s8">({</span><span class="s1"> days</span><span class="s8">:</span><span class="s1"> </span><span class="s12">Array</span><span class="s8">(</span><span class="s13">4</span><span class="s8">).</span><span class="s1">fill</span><span class="s8">({})</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> weeksContainer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">`weeks_</span><span class="s8">${</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentStudentId</span><span class="s8">}</span><span class="s9">`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> newWeekData </span><span class="s8">=</span><span class="s1"> student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks</span><span class="s8">[</span><span class="s1">student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks</span><span class="s8">.</span><span class="s1">length </span><span class="s8">-</span><span class="s1"> </span><span class="s13">1</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>weeksContainer</span><span class="s8">.</span><span class="s1">insertAdjacentHTML</span><span class="s8">(</span><span class="s9">'beforeend'</span><span class="s8">,</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">createWeekTableWithData</span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">,</span><span class="s1"> newWeekData</span><span class="s8">,</span><span class="s1"> student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks</span><span class="s8">.</span><span class="s1">length</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">captureAndSaveHalaqa</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>createStudentTab</span><span class="s8">(</span><span class="s1">student</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> tabsContainer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'studentsTabs'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> tab </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'div'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>tab</span><span class="s8">.</span><span class="s1">id </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`tab_</span><span class="s8">${</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span>tab</span><span class="s8">.</span><span class="s5">className </span><span class="s8">=</span><span class="s5"> </span><span class="s1">'student-tab px-4 py-2 rounded-lg border border-gray-300 font-bold flex items-center gap-2'</span><span class="s8">;</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span>tab</span><span class="s8">.</span><span class="s5">innerHTML </span><span class="s8">=</span><span class="s5"> </span><span class="s1">`&lt;span class="flex-1 select-none"&gt;</span><span class="s8">${</span><span class="s5">student</span><span class="s8">.</span><span class="s5">name</span><span class="s8">}</span><span class="s1">&lt;/span&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>tab</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">switchToStudent</span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> deleteBtn </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'button'</span><span class="s8">);</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span>deleteBtn</span><span class="s8">.</span><span class="s5">className </span><span class="s8">=</span><span class="s5"> </span><span class="s1">'delete-btn text-red-500 hover:text-red-700 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>deleteBtn</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'✕'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>deleteBtn</span><span class="s8">.</span><span class="s1">title </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'حذف الطالب'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>deleteBtn</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>e</span><span class="s8">.</span><span class="s1">stopPropagation</span><span class="s8">();</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">removeStudent</span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>tab</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">deleteBtn</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>tabsContainer</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">tab</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>createStudentContentWithData</span><span class="s8">(</span><span class="s1">student</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> contentContainer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'studentsContentContainer'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> studentDiv </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">'div'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>studentDiv</span><span class="s8">.</span><span class="s1">id </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`content_</span><span class="s8">${</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">}</span><span class="s9">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>studentDiv</span><span class="s8">.</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'student-content student-card'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> weeksHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">map</span><span class="s8">((</span><span class="s1">weekData</span><span class="s8">,</span><span class="s1"> index</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">createWeekTableWithData</span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">,</span><span class="s1"> weekData</span><span class="s8">,</span><span class="s1"> index </span><span class="s8">+</span><span class="s1"> </span><span class="s13">1</span><span class="s8">)).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>studentDiv</span><span class="s8">.</span><span class="s1">innerHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="border-2 border-blue-600 p-4 mb-6 bg-blue-50"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="grid grid-cols-1 md:grid-cols-3 gap-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;span class="font-bold"&gt;اسم الطالب:&lt;/span&gt; &lt;span class="text-blue-800 font-bold"&gt;</span><span class="s8">${</span><span class="s5">student</span><span class="s8">.</span><span class="s5">name</span><span class="s8">}</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;span class="font-bold"&gt;المرحلة الدراسية:&lt;/span&gt; &lt;span class="text-blue-800"&gt;</span><span class="s8">${</span><span class="s5">student</span><span class="s8">.</span><span class="s5">grade</span><span class="s8">}</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;span class="font-bold"&gt;السجل المدني:&lt;/span&gt; &lt;span class="text-blue-800"&gt;</span><span class="s8">${</span><span class="s5">student</span><span class="s8">.</span><span class="s5">civilId</span><span class="s8">}</span><span class="s1">&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="weeks_</span><span class="s8">${</span><span class="s5">student</span><span class="s8">.</span><span class="s5">id</span><span class="s8">}</span><span class="s1">"&gt;</span><span class="s8">${</span><span class="s5">weeksHTML</span><span class="s8">}</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="summary_</span><span class="s8">${</span><span class="s5">student</span><span class="s8">.</span><span class="s5">id</span><span class="s8">}</span><span class="s1">" class="mt-6 p-4 bg-gray-50 border border-gray-300 rounded-lg"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h4 class="font-bold text-center text-lg mb-2"&gt;الملخص النهائي للطالب&lt;/h4&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;p class="font-bold"&gt;إجمالي الحفظ: &lt;span class="total-memorization text-green-600"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;p class="font-bold"&gt;إجمالي المراجعة: &lt;span class="total-review text-indigo-600"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;p class="font-bold"&gt;أيام الحضور: &lt;span class="total-attendance text-teal-600"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;&lt;p class="font-bold"&gt;أيام الغياب: &lt;span class="total-absence text-red-600"&gt;0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>contentContainer</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">studentDiv</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>getHijriDateString</span><span class="s8">(</span><span class="s1">date</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s5"> formatter </span><span class="s8">=</span><span class="s5"> </span><span class="s7">new</span><span class="s5"> </span><span class="s12">Intl</span><span class="s8">.</span><span class="s12">DateTimeFormat</span><span class="s8">(</span><span class="s1">'ar-SA-u-ca-islamic'</span><span class="s8">,</span><span class="s5"> </span><span class="s8">{</span><span class="s5"> day</span><span class="s8">:</span><span class="s5"> </span><span class="s1">'2-digit'</span><span class="s8">,</span><span class="s5"> month</span><span class="s8">:</span><span class="s5"> </span><span class="s1">'2-digit'</span><span class="s8">,</span><span class="s5"> year</span><span class="s8">:</span><span class="s5"> </span><span class="s1">'numeric'</span><span class="s5"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> formatter</span><span class="s8">.</span><span class="s1">format</span><span class="s8">(</span><span class="s1">date</span><span class="s8">).</span><span class="s1">replace</span><span class="s8">(</span><span class="s14">/\s*هـ.*/</span><span class="s8">,</span><span class="s1"> </span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>createWeekTableWithData</span><span class="s8">(</span><span class="s1">studentId</span><span class="s8">,</span><span class="s1"> weekData</span><span class="s8">,</span><span class="s1"> weekNumber</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s5"> days </span><span class="s8">=</span><span class="s5"> </span><span class="s8">[</span><span class="s1">'الأحد'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'الاثنين'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'الثلاثاء'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'الأربعاء'</span><span class="s8">];</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> createTextField </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">dayIndex</span><span class="s8">,</span><span class="s1"> field</span><span class="s8">,</span><span class="s1"> placeholder </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">,</span><span class="s1"> value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">,</span><span class="s1"> type </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'text'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s5"> </span><span class="s1">`&lt;input type="</span><span class="s8">${</span><span class="s5">type</span><span class="s8">}</span><span class="s1">" placeholder="</span><span class="s8">${</span><span class="s5">placeholder</span><span class="s8">}</span><span class="s1">" value="</span><span class="s8">${</span><span class="s5">value </span><span class="s8">||</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">" class="w-full text-center border-gray-300 rounded" data-day-index="</span><span class="s8">${</span><span class="s5">dayIndex</span><span class="s8">}</span><span class="s1">" data-field="</span><span class="s8">${</span><span class="s5">field</span><span class="s8">}</span><span class="s1">"&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> createTextArea </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">dayIndex</span><span class="s8">,</span><span class="s1"> field</span><span class="s8">,</span><span class="s1"> placeholder </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">,</span><span class="s1"> value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s5"> </span><span class="s1">`&lt;textarea placeholder="</span><span class="s8">${</span><span class="s5">placeholder</span><span class="s8">}</span><span class="s1">" class="w-full border-gray-300 rounded text-sm p-1" rows="2" data-day-index="</span><span class="s8">${</span><span class="s5">dayIndex</span><span class="s8">}</span><span class="s1">" data-field="</span><span class="s8">${</span><span class="s5">field</span><span class="s8">}</span><span class="s1">"&gt;</span><span class="s8">${</span><span class="s5">value </span><span class="s8">||</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&lt;/textarea&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> createAttendanceSelect </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">dayIndex</span><span class="s8">,</span><span class="s1"> field</span><span class="s8">,</span><span class="s1"> value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s5"> </span><span class="s1">`&lt;select class="w-full border-gray-300 rounded attendance-select" data-day-index="</span><span class="s8">${</span><span class="s5">dayIndex</span><span class="s8">}</span><span class="s1">" data-field="</span><span class="s8">${</span><span class="s5">field</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value=""&gt;&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="حضر" </span><span class="s8">${</span><span class="s5">value </span><span class="s8">===</span><span class="s5"> </span><span class="s1">'حضر'</span><span class="s5"> </span><span class="s8">?</span><span class="s5"> </span><span class="s1">'selected'</span><span class="s5"> </span><span class="s8">:</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;حضر&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="غاب" </span><span class="s8">${</span><span class="s5">value </span><span class="s8">===</span><span class="s5"> </span><span class="s1">'غاب'</span><span class="s5"> </span><span class="s8">?</span><span class="s5"> </span><span class="s1">'selected'</span><span class="s5"> </span><span class="s8">:</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;غاب&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="مستأذن" </span><span class="s8">${</span><span class="s5">value </span><span class="s8">===</span><span class="s5"> </span><span class="s1">'مستأذن'</span><span class="s5"> </span><span class="s8">?</span><span class="s5"> </span><span class="s1">'selected'</span><span class="s5"> </span><span class="s8">:</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;مستأذن&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> createGradeSelect </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">dayIndex</span><span class="s8">,</span><span class="s1"> field</span><span class="s8">,</span><span class="s1"> value </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s5"> </span><span class="s1">`&lt;select class="w-full border-gray-300 rounded" data-day-index="</span><span class="s8">${</span><span class="s5">dayIndex</span><span class="s8">}</span><span class="s1">" data-field="</span><span class="s8">${</span><span class="s5">field</span><span class="s8">}</span><span class="s1">"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value=""&gt;&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="ممتاز" </span><span class="s8">${</span><span class="s5">value </span><span class="s8">===</span><span class="s5"> </span><span class="s1">'ممتاز'</span><span class="s5"> </span><span class="s8">?</span><span class="s5"> </span><span class="s1">'selected'</span><span class="s5"> </span><span class="s8">:</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;ممتاز&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="جيد جداً" </span><span class="s8">${</span><span class="s5">value </span><span class="s8">===</span><span class="s5"> </span><span class="s1">'جيد جداً'</span><span class="s5"> </span><span class="s8">?</span><span class="s5"> </span><span class="s1">'selected'</span><span class="s5"> </span><span class="s8">:</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;جيد جداً&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="جيد" </span><span class="s8">${</span><span class="s5">value </span><span class="s8">===</span><span class="s5"> </span><span class="s1">'جيد'</span><span class="s5"> </span><span class="s8">?</span><span class="s5"> </span><span class="s1">'selected'</span><span class="s5"> </span><span class="s8">:</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;جيد&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="مقبول" </span><span class="s8">${</span><span class="s5">value </span><span class="s8">===</span><span class="s5"> </span><span class="s1">'مقبول'</span><span class="s5"> </span><span class="s8">?</span><span class="s5"> </span><span class="s1">'selected'</span><span class="s5"> </span><span class="s8">:</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;مقبول&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;option value="ضعيف" </span><span class="s8">${</span><span class="s5">value </span><span class="s8">===</span><span class="s5"> </span><span class="s1">'ضعيف'</span><span class="s5"> </span><span class="s8">?</span><span class="s5"> </span><span class="s1">'selected'</span><span class="s5"> </span><span class="s8">:</span><span class="s5"> </span><span class="s1">''</span><span class="s8">}</span><span class="s1">&gt;ضعيف&lt;/option&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// --- MOBILE VIEW HTML ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> mobileDayCards </span><span class="s8">=</span><span class="s1"> days</span><span class="s8">.</span><span class="s1">map</span><span class="s8">((</span><span class="s1">day</span><span class="s8">,</span><span class="s1"> dayIndex</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> dayData </span><span class="s8">=</span><span class="s1"> weekData</span><span class="s8">.</span><span class="s1">days</span><span class="s8">?.[</span><span class="s1">dayIndex</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> hijriDateString </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">getHijriDateString</span><span class="s8">(</span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">());</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="border-b-2 border-gray-200 p-3 last:border-b-0"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex justify-between items-center mb-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h5 class="font-bold text-lg text-blue-800"&gt;</span><span class="s8">${</span><span class="s5">day</span><span class="s8">}</span><span class="s1">&lt;/h5&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="w-1/2"&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">                            </span></span><span class="s8">${</span><span class="s1">createTextField</span><span class="s8">(</span><span class="s1">dayIndex</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'date'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">''</span><span class="s8">,</span><span class="s1"> dayData</span><span class="s8">.</span><span class="s1">date </span><span class="s8">||</span><span class="s1"> hijriDateString</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mb-4"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;label class="block text-sm font-medium text-gray-700 mb-1"&gt;الحضور&lt;/label&gt;</span></p>
<p class="p4"><span class="s9"><span class="Apple-converted-space">                        </span></span><span class="s8">${</span><span class="s1">createAttendanceSelect</span><span class="s8">(</span><span class="s1">dayIndex</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'attendance'</span><span class="s8">,</span><span class="s1"> dayData</span><span class="s8">.</span><span class="s1">attendance</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Hifdh Section --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="bg-blue-50 p-3 rounded-lg border border-blue-200"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h6 class="font-bold mb-2 text-blue-700"&gt;الحفظ&lt;/h6&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="grid grid-cols-2 gap-3 items-center"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;السورة&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhSurah'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'السورة'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhSurah</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;من&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhFrom'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'آية'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhFrom</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;إلى&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhTo'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'آية'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhTo</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;التقدير&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createGradeSelect</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhGrade'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhGrade</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;عدد الأوجه&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhFaces'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'0'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhFaces</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'number'</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Murajaa Section --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div class="bg-green-50 p-3 rounded-lg border border-green-200 mt-3"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h6 class="font-bold mb-2 text-green-700"&gt;المراجعة&lt;/h6&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="grid grid-cols-2 gap-3 items-center"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;السورة&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaSurah'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'السورة'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaSurah</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;من&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaFrom'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'آية'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaFrom</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;إلى&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaTo'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'آية'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaTo</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;التقدير&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createGradeSelect</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaGrade'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaGrade</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium"&gt;عدد الأوجه&lt;/label&gt; </span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaFaces'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'0'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaFaces</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'number'</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Daily Notes Section --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-3"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;label class="block text-sm font-medium text-gray-700 mb-1"&gt;ملاحظات اليوم&lt;/label&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">${</span><span class="s5">createTextArea</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'notes'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'ملاحظات...'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">notes</span><span class="s8">)}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// --- DESKTOP VIEW HTML ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> desktopDayRows </span><span class="s8">=</span><span class="s1"> days</span><span class="s8">.</span><span class="s1">map</span><span class="s8">((</span><span class="s1">day</span><span class="s8">,</span><span class="s1"> dayIndex</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> dayData </span><span class="s8">=</span><span class="s1"> weekData</span><span class="s8">.</span><span class="s1">days</span><span class="s8">?.[</span><span class="s1">dayIndex</span><span class="s8">]</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> hijriDateString </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">getHijriDateString</span><span class="s8">(</span><span class="s7">new</span><span class="s1"> </span><span class="s12">Date</span><span class="s8">());</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> </span><span class="s9">`&lt;tr&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-2 font-bold bg-gray-50"&gt;</span><span class="s8">${</span><span class="s5">day</span><span class="s8">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'date'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">''</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">date </span><span class="s8">||</span><span class="s5"> hijriDateString</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createAttendanceSelect</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'attendance'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">attendance</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhSurah'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'السورة'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhSurah</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhFrom'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'آية'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhFrom</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhTo'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'آية'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhTo</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createGradeSelect</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhGrade'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhGrade</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'hifdhFaces'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">''</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">hifdhFaces</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'number'</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaSurah'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'السورة'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaSurah</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaFrom'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'آية'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaFrom</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaTo'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'آية'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaTo</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createGradeSelect</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaGrade'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaGrade</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextField</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'murajaaFaces'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">''</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">murajaaFaces</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'number'</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="border p-1"&gt;</span><span class="s8">${</span><span class="s5">createTextArea</span><span class="s8">(</span><span class="s5">dayIndex</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'notes'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'ملاحظات'</span><span class="s8">,</span><span class="s5"> dayData</span><span class="s8">.</span><span class="s5">notes</span><span class="s8">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/tr&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}).</span><span class="s1">join</span><span class="s8">(</span><span class="s9">''</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s5"> </span><span class="s1">`&lt;div class="week-table mb-8 border border-gray-400 rounded-lg overflow-hidden"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h4 class="font-bold p-2 bg-gray-100 text-center"&gt;الأسبوع </span><span class="s8">${</span><span class="s5">weekNumber</span><span class="s8">}</span><span class="s1">&lt;/h4&gt;</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Mobile View --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="block md:hidden"&gt;</span><span class="s8">${</span><span class="s5">mobileDayCards</span><span class="s8">}</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Desktop View --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="hidden md:block"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="overflow-x-auto"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;table class="w-full text-sm min-w-[1200px] whitespace-nowrap"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;thead class="bg-gray-200"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;tr&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th rowspan="2" class="border p-1"&gt;اليوم&lt;/th&gt;&lt;th rowspan="2" class="border p-1"&gt;التاريخ&lt;/th&gt;&lt;th rowspan="2" class="border p-1"&gt;الحضور&lt;/th&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th colspan="5" class="border p-1"&gt;الحفظ&lt;/th&gt;&lt;th colspan="5" class="border p-1"&gt;المراجعة&lt;/th&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th rowspan="2" class="border p-1"&gt;الملاحظات&lt;/th&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/tr&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;tr class="bg-gray-100 text-xs"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th class="border p-1"&gt;السورة&lt;/th&gt;&lt;th class="border p-1"&gt;من&lt;/th&gt;&lt;th class="border p-1"&gt;إلى&lt;/th&gt;&lt;th class="border p-1"&gt;التقدير&lt;/th&gt;&lt;th class="border p-1"&gt;عدد الأوجه&lt;/th&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th class="border p-1"&gt;السورة&lt;/th&gt;&lt;th class="border p-1"&gt;من&lt;/th&gt;&lt;th class="border p-1"&gt;إلى&lt;/th&gt;&lt;th class="border p-1"&gt;التقدير&lt;/th&gt;&lt;th class="border p-1"&gt;عدد الأوجه&lt;/th&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/tr&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/thead&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;tbody&gt;</span><span class="s8">${</span><span class="s5">desktopDayRows</span><span class="s8">}</span><span class="s1">&lt;/tbody&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/table&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="bg-yellow-50 font-bold p-2 text-center grid grid-cols-1 sm:grid-cols-2"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div&gt;حصيلة الحفظ الأسبوعية: &lt;span class="weekly-memorization"&gt;0&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div&gt;حصيلة المراجعة الأسبوعية: &lt;span class="weekly-review"&gt;0&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>captureStudentData</span><span class="s8">(</span><span class="s1">studentId</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> student </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">find</span><span class="s8">(</span><span class="s1">s </span><span class="s8">=&gt;</span><span class="s1"> s</span><span class="s8">.</span><span class="s1">id </span><span class="s8">===</span><span class="s1"> studentId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">student</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> contentElement </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">`content_</span><span class="s8">${</span><span class="s1">studentId</span><span class="s8">}</span><span class="s9">`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">contentElement</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> weekTables </span><span class="s8">=</span><span class="s1"> contentElement</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.week-table'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>weekTables</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">table </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> weekData </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>days</span><span class="s8">:</span><span class="s1"> </span><span class="s12">Array</span><span class="s8">(</span><span class="s13">4</span><span class="s8">).</span><span class="s1">fill</span><span class="s8">(</span><span class="s13">0</span><span class="s8">).</span><span class="s1">map</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">({}))</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">};</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s5"> allInputs </span><span class="s8">=</span><span class="s5"> table</span><span class="s8">.</span><span class="s5">querySelectorAll</span><span class="s8">(</span><span class="s1">'input[data-field], select[data-field], textarea[data-field]'</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>allInputs</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">input </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> dayIndex </span><span class="s8">=</span><span class="s1"> input</span><span class="s8">.</span><span class="s1">dataset</span><span class="s8">.</span><span class="s1">dayIndex</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> field </span><span class="s8">=</span><span class="s1"> input</span><span class="s8">.</span><span class="s1">dataset</span><span class="s8">.</span><span class="s1">field</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">dayIndex </span><span class="s8">!==</span><span class="s1"> </span><span class="s7">undefined</span><span class="s1"> </span><span class="s8">&amp;&amp;</span><span class="s1"> field</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">weekData</span><span class="s8">.</span><span class="s1">days</span><span class="s8">[</span><span class="s1">dayIndex</span><span class="s8">])</span><span class="s1"> weekData</span><span class="s8">.</span><span class="s1">days</span><span class="s8">[</span><span class="s1">dayIndex</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>weekData</span><span class="s8">.</span><span class="s1">days</span><span class="s8">[</span><span class="s1">dayIndex</span><span class="s8">][</span><span class="s1">field</span><span class="s8">]</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> input</span><span class="s8">.</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks</span><span class="s8">.</span><span class="s1">push</span><span class="s8">(</span><span class="s1">weekData</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>calculateAllTotals</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">student </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">captureStudentData</span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">));</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> halaqaTotalMemorization </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> halaqaTotalReview </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> halaqaTotalAttendance </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> halaqaTotalAbsence </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students</span><span class="s8">.</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">student </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> studentTotalMemorization </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> studentTotalReview </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> studentTotalAttendance </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> studentTotalAbsence </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> studentContent </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">`content_</span><span class="s8">${</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">}</span><span class="s9">`</span><span class="s8">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">((</span><span class="s1">week</span><span class="s8">,</span><span class="s1"> weekIndex</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">let</span><span class="s1"> weeklyMemorization </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">,</span><span class="s1"> weeklyReview </span><span class="s8">=</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">(</span><span class="s1">week</span><span class="s8">.</span><span class="s1">days </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">day </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>weeklyMemorization </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">Number</span><span class="s8">(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">hifdhFaces</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>weeklyReview </span><span class="s8">+=</span><span class="s1"> </span><span class="s12">Number</span><span class="s8">(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">murajaaFaces</span><span class="s8">)</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> </span><span class="s13">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">attendance </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'حضر'</span><span class="s8">)</span><span class="s1"> studentTotalAttendance</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">attendance </span><span class="s8">===</span><span class="s1"> </span><span class="s9">'غاب'</span><span class="s8">)</span><span class="s1"> studentTotalAbsence</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">studentContent</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> weekTable </span><span class="s8">=</span><span class="s1"> studentContent</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.week-table'</span><span class="s8">)[</span><span class="s1">weekIndex</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">weekTable</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>weekTable</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.weekly-memorization'</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">el </span><span class="s8">=&gt;</span><span class="s1"> el</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> weeklyMemorization</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>weekTable</span><span class="s8">.</span><span class="s1">querySelectorAll</span><span class="s8">(</span><span class="s9">'.weekly-review'</span><span class="s8">).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">el </span><span class="s8">=&gt;</span><span class="s1"> el</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> weeklyReview</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>studentTotalMemorization </span><span class="s8">+=</span><span class="s1"> weeklyMemorization</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>studentTotalReview </span><span class="s8">+=</span><span class="s1"> weeklyReview</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">studentContent</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> summaryDiv </span><span class="s8">=</span><span class="s1"> studentContent</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">`#summary_</span><span class="s8">${</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">}</span><span class="s9">`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s8">(</span><span class="s1">summaryDiv</span><span class="s8">){</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>summaryDiv</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'.total-memorization'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> studentTotalMemorization</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>summaryDiv</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'.total-review'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> studentTotalReview</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>summaryDiv</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'.total-attendance'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> studentTotalAttendance</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>summaryDiv</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'.total-absence'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> studentTotalAbsence</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>halaqaTotalMemorization </span><span class="s8">+=</span><span class="s1"> studentTotalMemorization</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>halaqaTotalReview </span><span class="s8">+=</span><span class="s1"> studentTotalReview</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>halaqaTotalAttendance </span><span class="s8">+=</span><span class="s1"> studentTotalAttendance</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>halaqaTotalAbsence </span><span class="s8">+=</span><span class="s1"> studentTotalAbsence</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> halaqaSummaryDiv </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'halaqaSummary'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>halaqaSummaryDiv</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'#halaqaTotalMemorization'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> halaqaTotalMemorization</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>halaqaSummaryDiv</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'#halaqaTotalReview'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> halaqaTotalReview</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>halaqaSummaryDiv</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'#halaqaTotalAttendance'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> halaqaTotalAttendance</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>halaqaSummaryDiv</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'#halaqaTotalAbsence'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> halaqaTotalAbsence</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>halaqaSummaryDiv</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s5">showMessage</span><span class="s8">(</span><span class="s1">"تم حساب جميع المجاميع بنجاح!"</span><span class="s8">,</span><span class="s5"> </span><span class="s1">"success"</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>exportHalaqaToCSV</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'لا توجد حلقة لتصديرها'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'warning'</span><span class="s8">);</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s5"> headers </span><span class="s8">=</span><span class="s5"> </span><span class="s8">[</span><span class="s1">'اسم الطالب'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'المرحلة الدراسية'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'السجل المدني'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'الأسبوع'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'اليوم'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'التاريخ'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'الحضور'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'سورة الحفظ'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'الحفظ من'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'الحفظ إلى'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'تقدير الحفظ'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'أوجه الحفظ'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'سورة المراجعة'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'المراجعة من'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'المراجعة إلى'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'تقدير المراجعة'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'أوجه المراجعة'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'ملاحظات اليوم'</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> csvContent </span><span class="s8">=</span><span class="s1"> </span><span class="s9">"\uFEFF"</span><span class="s8">;</span><span class="s1"> </span><span class="s15">// BOM for Arabic Excel</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>csvContent </span><span class="s8">+=</span><span class="s1"> headers</span><span class="s8">.</span><span class="s1">join</span><span class="s8">(</span><span class="s9">','</span><span class="s8">)</span><span class="s1"> </span><span class="s8">+</span><span class="s1"> </span><span class="s9">'\r\n'</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">students </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">student </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">((</span><span class="s1">week</span><span class="s8">,</span><span class="s1"> weekIndex</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> daysOfWeek </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span><span class="s9">'الأحد'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'الاثنين'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'الثلاثاء'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'الأربعاء'</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">(</span><span class="s1">week</span><span class="s8">.</span><span class="s1">days </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">((</span><span class="s1">day</span><span class="s8">,</span><span class="s1"> dayIndex</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> row </span><span class="s8">=</span><span class="s1"> </span><span class="s8">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">`"</span><span class="s8">${</span><span class="s1">student</span><span class="s8">.</span><span class="s1">name</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">student</span><span class="s8">.</span><span class="s1">grade</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">student</span><span class="s8">.</span><span class="s1">civilId</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>weekIndex </span><span class="s8">+</span><span class="s1"> </span><span class="s13">1</span><span class="s8">,</span><span class="s1"> daysOfWeek</span><span class="s8">[</span><span class="s1">dayIndex</span><span class="s8">],</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">date </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">attendance </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">hifdhSurah </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">hifdhFrom </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">hifdhTo </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">hifdhGrade </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">hifdhFaces </span><span class="s8">||</span><span class="s1"> </span><span class="s9">'0'</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">murajaaSurah </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">murajaaFrom </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">murajaaTo </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">murajaaGrade </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`"</span><span class="s8">${</span><span class="s1">day</span><span class="s8">.</span><span class="s1">murajaaFaces </span><span class="s8">||</span><span class="s1"> </span><span class="s9">'0'</span><span class="s8">}</span><span class="s9">"`</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">`"</span><span class="s8">${(</span><span class="s1">day</span><span class="s8">.</span><span class="s1">notes </span><span class="s8">||</span><span class="s1"> </span><span class="s9">''</span><span class="s8">).</span><span class="s1">replace</span><span class="s8">(</span><span class="s14">/"/</span><span class="s7">g</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'""'</span><span class="s8">)}</span><span class="s9">"`</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">].</span><span class="s1">join</span><span class="s8">(</span><span class="s9">','</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>csvContent </span><span class="s8">+=</span><span class="s1"> row </span><span class="s8">+</span><span class="s1"> </span><span class="s9">'\r\n'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> blob </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">Blob</span><span class="s8">([</span><span class="s1">csvContent</span><span class="s8">],</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> type</span><span class="s8">:</span><span class="s1"> </span><span class="s9">'text/csv;charset=utf-8;'</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> link </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s9">"a"</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> url </span><span class="s8">=</span><span class="s1"> </span><span class="s12">URL</span><span class="s8">.</span><span class="s1">createObjectURL</span><span class="s8">(</span><span class="s1">blob</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>link</span><span class="s8">.</span><span class="s1">setAttribute</span><span class="s8">(</span><span class="s9">"href"</span><span class="s8">,</span><span class="s1"> url</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>link</span><span class="s8">.</span><span class="s1">setAttribute</span><span class="s8">(</span><span class="s9">"download"</span><span class="s8">,</span><span class="s1"> </span><span class="s9">`</span><span class="s8">${</span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">.</span><span class="s1">circleName </span><span class="s8">||</span><span class="s1"> </span><span class="s9">'halaqa'</span><span class="s8">}</span><span class="s9">.csv`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">body</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">link</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>link</span><span class="s8">.</span><span class="s1">click</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">body</span><span class="s8">.</span><span class="s1">removeChild</span><span class="s8">(</span><span class="s1">link</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>generatePrintableReport</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">captureAndSaveHalaqa</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> halaqa </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">halaqa</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> reportHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!DOCTYPE html&gt;&lt;html lang="ar" dir="rtl"&gt;&lt;head&gt;&lt;meta charset="UTF-8"&gt;&lt;title&gt;تقرير حلقة </span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">circleName</span><span class="s8">}</span><span class="s1">&lt;/title&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;\/script&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;style&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>@import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;display=swap');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>body { font-family: 'Amiri', serif; margin: 20px; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>.student-card { page-break-inside: avoid; margin-bottom: 2rem; border: 1px solid #ccc; padding: 1rem; border-radius: 0.5rem;}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>thead { background-color: #f2f2f2; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>.notes-section { margin-top: 1rem; padding: 0.5rem; border-top: 2px solid #eee; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/style&gt;&lt;/head&gt;&lt;body&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h1 class="text-3xl font-bold text-center mb-2"&gt;تقرير حلقة: </span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">circleName</span><span class="s8">}</span><span class="s1">&lt;/h1&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-xl text-center mb-6"&gt;المعلم: </span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">teacherName</span><span class="s8">}</span><span class="s1"> | الشهر: </span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">month</span><span class="s8">}</span><span class="s1">&lt;/h2&gt;`</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">(</span><span class="s1">halaqa</span><span class="s8">.</span><span class="s1">students </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">(</span><span class="s1">student </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                </span>reportHTML </span><span class="s8">+=</span><span class="s5"> </span><span class="s1">`&lt;div class="student-card"&gt;&lt;h3 class="text-2xl font-bold mb-4"&gt;الطالب: </span><span class="s8">${</span><span class="s5">student</span><span class="s8">.</span><span class="s5">name</span><span class="s8">}</span><span class="s1">&lt;/h3&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">data</span><span class="s8">.</span><span class="s1">weeks </span><span class="s8">||</span><span class="s1"> </span><span class="s8">[]).</span><span class="s1">forEach</span><span class="s8">((</span><span class="s1">week</span><span class="s8">,</span><span class="s1"> index</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>reportHTML </span><span class="s8">+=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">createWeekTableWithData</span><span class="s8">(</span><span class="s1">student</span><span class="s8">.</span><span class="s1">id</span><span class="s8">,</span><span class="s1"> week</span><span class="s8">,</span><span class="s1"> index </span><span class="s8">+</span><span class="s1"> </span><span class="s13">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>reportHTML </span><span class="s8">+=</span><span class="s1"> </span><span class="s9">`&lt;/div&gt;`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportHTML </span><span class="s8">+=</span><span class="s1"> </span><span class="s9">`&lt;/body&gt;&lt;/html&gt;`</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> reportWindow </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">.</span><span class="s1">open</span><span class="s8">(</span><span class="s9">''</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'_blank'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">document</span><span class="s8">.</span><span class="s1">write</span><span class="s8">(</span><span class="s1">reportHTML</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">document</span><span class="s8">.</span><span class="s1">close</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">onload </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> reportWindow</span><span class="s8">.</span><span class="s1">print</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>printHalaqaSummary</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">captureAndSaveHalaqa</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> halaqa </span><span class="s8">=</span><span class="s1"> </span><span class="s7">this</span><span class="s8">.</span><span class="s1">currentHalaqa</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> summaryNode </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'halaqaSummary'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">halaqa </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">summaryNode</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> summaryContent </span><span class="s8">=</span><span class="s1"> summaryNode</span><span class="s8">.</span><span class="s1">cloneNode</span><span class="s8">(</span><span class="s7">true</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> btnInClone </span><span class="s8">=</span><span class="s1"> summaryContent</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'#printSummaryBtn'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">btnInClone</span><span class="s8">)</span><span class="s1"> btnInClone</span><span class="s8">.</span><span class="s1">parentElement</span><span class="s8">.</span><span class="s1">replaceWith</span><span class="s8">(</span><span class="s1">summaryContent</span><span class="s8">.</span><span class="s1">querySelector</span><span class="s8">(</span><span class="s9">'h3'</span><span class="s8">));</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> reportHTML </span><span class="s8">=</span><span class="s1"> </span><span class="s9">`</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!DOCTYPE html&gt;&lt;html lang="ar" dir="rtl"&gt;&lt;head&gt;&lt;meta charset="UTF-8"&gt;&lt;title&gt;ملخص إنجازات حلقة </span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">circleName</span><span class="s8">}</span><span class="s1">&lt;/title&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;\/script&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;style&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>@import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;display=swap');</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>body { font-family: 'Amiri', serif; margin: 20px; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>.summary-container { margin-top: 2rem; padding: 1.5rem; background-color: #eff6ff; border: 1px solid #93c5fd; border-radius: 0.5rem; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/style&gt;&lt;/head&gt;&lt;body&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="container mx-auto max-w-4xl"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="text-center"&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h1 class="text-3xl font-bold mb-2"&gt;ملخص إنجازات حلقة: </span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">circleName</span><span class="s8">}</span><span class="s1">&lt;/h1&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h2 class="text-xl mb-6"&gt;المعلم: </span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">teacherName</span><span class="s8">}</span><span class="s1"> | الشهر: </span><span class="s8">${</span><span class="s5">halaqa</span><span class="s8">.</span><span class="s5">month </span><span class="s8">||</span><span class="s5"> </span><span class="s1">'غير محدد'</span><span class="s8">}</span><span class="s1">&lt;/h2&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="summary-container"&gt;</span><span class="s8">${</span><span class="s5">summaryContent</span><span class="s8">.</span><span class="s5">innerHTML</span><span class="s8">}</span><span class="s1">&lt;/div&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;`</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> reportWindow </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">.</span><span class="s1">open</span><span class="s8">(</span><span class="s9">''</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'_blank'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">document</span><span class="s8">.</span><span class="s1">write</span><span class="s8">(</span><span class="s1">reportHTML</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">document</span><span class="s8">.</span><span class="s1">close</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reportWindow</span><span class="s8">.</span><span class="s1">onload </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> reportWindow</span><span class="s8">.</span><span class="s1">print</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>showMessage</span><span class="s8">(</span><span class="s1">message</span><span class="s8">,</span><span class="s1"> type </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'info'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> statusDiv </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'saveStatus'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>statusDiv</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> message</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> colors </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                </span>success</span><span class="s8">:</span><span class="s5"> </span><span class="s1">'bg-green-100 border-green-300 text-green-800'</span><span class="s8">,</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                </span>warning</span><span class="s8">:</span><span class="s5"> </span><span class="s1">'bg-yellow-100 border-yellow-300 text-yellow-800'</span><span class="s8">,</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                </span>info</span><span class="s8">:</span><span class="s5"> </span><span class="s1">'bg-blue-100 border-blue-300 text-blue-800'</span><span class="s8">,</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">                </span>error</span><span class="s8">:</span><span class="s5"> </span><span class="s1">'bg-red-100 border-red-300 text-red-800'</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span>statusDiv</span><span class="s8">.</span><span class="s5">className </span><span class="s8">=</span><span class="s5"> </span><span class="s1">`p-3 rounded-lg border text-center font-bold </span><span class="s8">${</span><span class="s5">colors</span><span class="s8">[</span><span class="s5">type</span><span class="s8">]}</span><span class="s1">`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>clearTimeout</span><span class="s8">(</span><span class="s7">this</span><span class="s8">.</span><span class="s1">messageTimeout</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">this</span><span class="s8">.</span><span class="s1">messageTimeout </span><span class="s8">=</span><span class="s1"> setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> statusDiv</span><span class="s8">.</span><span class="s1">className </span><span class="s8">=</span><span class="s1"> </span><span class="s9">'hidden'</span><span class="s8">;</span><span class="s1"> </span><span class="s8">},</span><span class="s1"> </span><span class="s13">3000</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> app </span><span class="s8">=</span><span class="s1"> </span><span class="s7">new</span><span class="s1"> </span><span class="s12">AppManager</span><span class="s8">();</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">// Bind events for elements that exist on page load</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'selectMenBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> app</span><span class="s8">.</span><span class="s1">selectSection</span><span class="s8">(</span><span class="s9">'men'</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'selectWomenBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> app</span><span class="s8">.</span><span class="s1">selectSection</span><span class="s8">(</span><span class="s9">'women'</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'backToSectionsBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">location</span><span class="s8">.</span><span class="s1">hash </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>app</span><span class="s8">.</span><span class="s1">showView</span><span class="s8">(</span><span class="s9">'selectionView'</span><span class="s8">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'backToDashboardBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">location</span><span class="s8">.</span><span class="s1">hash </span><span class="s8">=</span><span class="s1"> </span><span class="s9">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>app</span><span class="s8">.</span><span class="s1">showView</span><span class="s8">(</span><span class="s9">'dashboardView'</span><span class="s8">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'addNewHalaqaBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> app</span><span class="s8">.</span><span class="s1">addNewHalaqa</span><span class="s8">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'generateReportBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> app</span><span class="s8">.</span><span class="s1">generateSectionReport</span><span class="s8">());</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'copyShareLinkBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> linkInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'shareLinkInput'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>linkInput</span><span class="s8">.</span><span class="s1">select</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>linkInput</span><span class="s8">.</span><span class="s1">setSelectionRange</span><span class="s8">(</span><span class="s13">0</span><span class="s8">,</span><span class="s1"> </span><span class="s13">99999</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">execCommand</span><span class="s8">(</span><span class="s9">'copy'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>app</span><span class="s8">.</span><span class="s1">halaqaManager</span><span class="s8">.</span><span class="s1">showMessage</span><span class="s8">(</span><span class="s9">'تم نسخ الرابط بنجاح!'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">'success'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">err</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span>app</span><span class="s8">.</span><span class="s5">halaqaManager</span><span class="s8">.</span><span class="s5">showMessage</span><span class="s8">(</span><span class="s1">'فشل نسخ الرابط. يرجى النسخ يدوياً.'</span><span class="s8">,</span><span class="s5"> </span><span class="s1">'error'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'closeShareModalBtn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'shareModal'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s9">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">// Use event delegation for dynamically created elements</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s9">'halaqaList'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s9">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> target </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">target</span><span class="s8">.</span><span class="s1">closest</span><span class="s8">(</span><span class="s9">'button'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">target</span><span class="s8">)</span><span class="s1"> </span><span class="s7">return</span><span class="s8">;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> halaqaId </span><span class="s8">=</span><span class="s1"> target</span><span class="s8">.</span><span class="s1">dataset</span><span class="s8">.</span><span class="s1">halaqaId</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">target</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">contains</span><span class="s8">(</span><span class="s9">'open-halaqa-btn'</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>app</span><span class="s8">.</span><span class="s1">openHalaqa</span><span class="s8">(</span><span class="s1">halaqaId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">target</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">contains</span><span class="s8">(</span><span class="s9">'delete-halaqa-btn'</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>app</span><span class="s8">.</span><span class="s1">deleteHalaqa</span><span class="s8">(</span><span class="s1">halaqaId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span><span class="s1"> </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">target</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">contains</span><span class="s8">(</span><span class="s9">'share-halaqa-btn'</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>app</span><span class="s8">.</span><span class="s1">shareHalaqa</span><span class="s8">(</span><span class="s1">halaqaId</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s8">});</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s11"></span><br></p>
<p class="p6"><span class="s11"></span><br></p>
</body>
</html>
